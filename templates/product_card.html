<!-- Product Card Template -->
{% load product_extras %}
<div class="product-item card h-100 border-0 shadow-sm">
    <div class="position-relative product-image-container" style="height: 200px; overflow: hidden;">
        {% if product.main_image %}
        <img src="{{ product.main_image.url }}" class="card-img-top w-100 h-100" alt="{{ product.name }}" style="object-fit: cover;">
        {% else %}
        <div class="bg-light d-flex align-items-center justify-content-center h-100">
            <i class="fas fa-image text-muted fs-2"></i>
        </div>
        {% endif %}
        
        <!-- Product badges - Only show 2 maximum, positioned left and right -->
        {% if product.is_featured %}
        <span class="badge bg-warning position-absolute top-0 start-0 m-2 px-2 py-1" style="font-size: 0.7rem;">Featured</span>
        {% endif %}
        
        {% if product.discount_percentage %}
        <span class="badge bg-danger position-absolute top-0 end-0 m-2 px-2 py-1" style="font-size: 0.7rem;">
            -{{ product.discount_percentage }}%
        </span>
        {% elif product.stock_status == 'low_stock' %}
        <span class="badge bg-warning text-dark position-absolute top-0 end-0 m-2 px-2 py-1" style="font-size: 0.7rem;">
            Low Stock
        </span>
        {% elif product.stock_status == 'out_of_stock' %}
        <span class="badge bg-danger position-absolute top-0 end-0 m-2 px-2 py-1" style="font-size: 0.7rem;">
            Out of Stock
        </span>
        {% elif not product.is_featured and product.is_organic %}
        <span class="badge bg-success position-absolute top-0 end-0 m-2 px-2 py-1" style="font-size: 0.7rem;">Organic</span>
        {% endif %}
        
        <!-- Quick view overlay - compact version -->
        <div class="position-absolute top-50 start-50 translate-middle opacity-0 quick-view-overlay">
            <a href="{{ product.get_absolute_url }}" class="btn btn-light btn-sm rounded-circle me-1">
                <i class="fas fa-eye" style="font-size: 0.8rem;"></i>
            </a>
            {% if product.stock_status != 'out_of_stock' %}
            <button class="btn btn-success btn-sm rounded-circle" onclick="orderViaWhatsApp('{{ product.name }}', '{{ product.selling_price }}')">
                <i class="fab fa-whatsapp" style="font-size: 0.8rem;"></i>
            </button>
            {% endif %}
        </div>
    </div>
    
    <div class="card-body text-center p-3">
        <h6 class="card-title mb-2" style="height: 40px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;">
            <a href="{{ product.get_absolute_url }}" class="text-decoration-none text-dark">
                {{ product.name|truncatechars:30 }}
            </a>
        </h6>
        
        <p class="text-muted mb-1" style="font-size: 0.75rem;">
            {{ product.category.name }}
            {% if product.subcategory %}
            - {{ product.subcategory.name|truncatechars:15 }}
            {% endif %}
        </p>
        
        <div class="price mb-2">
            <span class="fw-bold text-success fs-6">KSh {{ product.selling_price }}</span>
            {% if product.discount_price %}
            <span class="text-muted text-decoration-line-through ms-1" style="font-size: 0.8rem;">KSh {{ product.price }}</span>
            {% endif %}
        </div>
        
        <!-- Rating - compact version -->
        {% if product.reviews.count %}
        <div class="rating mb-2">
            {% with avg_rating=product.reviews.all|avg_rating %}
            <div class="rating-stars">
                {% for i in "12345"|make_list %}
                    {% if forloop.counter <= avg_rating %}
                    <i class="fas fa-star text-warning" style="font-size: 0.7rem;"></i>
                    {% else %}
                    <i class="far fa-star text-warning" style="font-size: 0.7rem;"></i>
                    {% endif %}
                {% endfor %}
            </div>
            <small class="text-muted" style="font-size: 0.7rem;">({{ product.reviews.count }}) Reviews</small>
            {% endwith %}
        </div>
        {% endif %}
     
        
        <!-- Product attributes - show only 1 most important -->
        {% if product.attributes.all %}
        <div class="product-attributes mb-2">
            {% for attr in product.attributes.all|slice:":1" %}
            <small class="badge bg-light text-dark" style="font-size: 0.65rem;">{{ attr.name }}: {{ attr.value|truncatechars:10 }}</small>
            {% endfor %}
        </div>
        {% endif %}
    </div>
    
    <div class="d-flex border-top">
        <small class="w-50 text-center border-end py-2">
            <a class="text-body text-decoration-none" href="{{ product.get_absolute_url }}">
                 <i class="fa fa-eye text-primary me-1" style="font-size: 0.8rem;"></i>View
            </a>
        </small>
        <small class="w-50 text-center py-2">
            {% if product.stock_status != 'out_of_stock' %}
            <a class="text-body text-decoration-none" href="#" onclick="orderViaWhatsApp('{{ product.name }}', '{{ product.selling_price }}')">
               <i class="fab fa-whatsapp text-success me-1" style="font-size: 0.8rem;"></i>Order
            </a>
            {% else %}
            <span class="text-muted">
                <i class="fas fa-ban me-1" style="font-size: 0.8rem;"></i>Unavailable
            </span>
            {% endif %}
        </small>
   </div>
</div>

<style>
.product-item:hover .quick-view-overlay {
    opacity: 1 !important;
}

.quick-view-overlay {
    background: rgba(0,0,0,0.8);
    border-radius: 25px;
    padding: 8px 12px;
    transition: opacity 0.3s ease;
}

.product-item:hover {
    transform: translateY(-2px);
    transition: transform 0.2s ease;
}

.card-title a:hover {
    color: #28a745 !important;
}
</style>