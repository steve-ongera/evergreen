<!-- Product Card Template -->
 {% load product_extras %}
<div class="product-item card h-100 border-0 shadow-sm">
    <div class="position-relative product-image-container">
        {% if product.main_image %}
        <img src="{{ product.main_image.url }}" class="card-img-top" alt="{{ product.name }}">
        {% else %}
        <div class="bg-light d-flex align-items-center justify-content-center h-100">
            <i class="fas fa-image text-muted fs-1"></i>
        </div>
        {% endif %}
        
        <!-- Product badges -->
        <div class="product-badges">
            {% if product.is_featured %}
            <span class="badge bg-warning product-badge">Featured</span>
            {% endif %}
            {% if product.is_organic %}
            <span class="badge bg-success product-badge" style="top: {% if product.is_featured %}45px{% else %}10px{% endif %};">Organic</span>
            {% endif %}
            {% if product.discount_percentage %}
            <span class="badge bg-danger product-badge" style="top: {% if product.is_organic and product.is_featured %}80px{% elif product.is_organic or product.is_featured %}45px{% else %}10px{% endif %};">
                -{{ product.discount_percentage }}%
            </span>
            {% endif %}
            {% if product.stock_status == 'low_stock' %}
            <span class="badge bg-warning text-dark position-absolute" style="top: 10px; right: 10px;">
                Low Stock
            </span>
            {% elif product.stock_status == 'out_of_stock' %}
            <span class="badge bg-danger position-absolute" style="top: 10px; right: 10px;">
                Out of Stock
            </span>
            {% endif %}
        </div>
        
        <!-- Quick view overlay -->
        <div class="position-absolute top-50 start-50 translate-middle opacity-0 quick-view-overlay transition-all">
            <a href="{{ product.get_absolute_url }}" class="btn btn-light btn-sm rounded-circle me-2">
                <i class="fas fa-eye"></i>
            </a>
            {% if product.stock_status != 'out_of_stock' %}
            <button class="btn btn-success btn-sm rounded-circle" onclick="orderViaWhatsApp('{{ product.name }}', '{{ product.selling_price }}')">
                <i class="fab fa-whatsapp"></i>
            </button>
            {% endif %}
        </div>
    </div>
    
    <div class="card-body text-center p-4">
        <h6 class="card-title mb-2">
            <a href="{{ product.get_absolute_url }}" class="text-decoration-none text-dark">
                {{ product.name|truncatechars:40 }}
            </a>
        </h6>
        <p class="text-muted small mb-2">
            {{ product.category.name }}
            {% if product.subcategory %}
            - {{ product.subcategory.name }}
            {% endif %}
        </p>
        
        <div class="price mb-3">
            <span class="fw-bold text-success fs-5">KSh {{ product.selling_price }}</span>
            {% if product.discount_price %}
            <span class="price-original ms-2 small">KSh {{ product.price }}</span>
            {% endif %}
        </div>
        
        <!-- Rating -->
        {% if product.reviews.count %}
        <div class="rating mb-3">
            {% with avg_rating=product.reviews.all|avg_rating %}
            <div class="rating-stars">
                {% for i in "12345"|make_list %}
                    {% if forloop.counter <= avg_rating %}
                    <i class="fas fa-star text-warning"></i>
                    {% else %}
                    <i class="far fa-star text-warning"></i>
                    {% endif %}
                {% endfor %}
            </div>
            <small class="text-muted">({{ product.reviews.count }} review{{ product.reviews.count|pluralize }})</small>
            {% endwith %}
        </div>
        {% endif %}
        
        <!-- Product attributes -->
        {% if product.attributes.all %}
        <div class="product-attributes mb-3">
            {% for attr in product.attributes.all|slice:":2" %}
            <small class="badge bg-light text-dark me-1">{{ attr.name }}: {{ attr.value }}</small>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- Stock info -->
        <div class="stock-info mb-3">
            {% if product.stock_status == 'in_stock' %}
            <small class="text-success"><i class="fas fa-check-circle me-1"></i>In Stock ({{ product.stock_quantity }} {{ product.unit }})</small>
            {% elif product.stock_status == 'low_stock' %}
            <small class="text-warning"><i class="fas fa-exclamation-triangle me-1"></i>Only {{ product.stock_quantity }} left</small>
            {% elif product.stock_status == 'out_of_stock' %}
            <small class="text-danger"><i class="fas fa-times-circle me-1"></i>Out of Stock</small>
            {% endif %}
        </div>
    </div>
    
    <div class="card-footer bg-white border-0 pt-0">
        <div class="d-flex gap-2">
            <a href="{{ product.get_absolute_url }}" class="btn btn-outline-primary flex-fill btn-sm">
                <i class="fas fa-eye me-1"></i>View Details
            </a>
            {% if product.stock_status != 'out_of_stock' %}
            <button class="btn btn-success whatsapp-btn flex-fill btn-sm" onclick="orderViaWhatsApp('{{ product.name }}', '{{ product.selling_price }}')">
                <i class="fab fa-whatsapp me-1"></i>Order Now
            </button>
            {% else %}
            <button class="btn btn-secondary flex-fill btn-sm" disabled>
                <i class="fas fa-ban me-1"></i>Unavailable
            </button>
            {% endif %}
        </div>
    </div>
</div>

<style>
.product-item:hover .quick-view-overlay {
    opacity: 1 !important;
}

.product-image-container {
    position: relative;
    overflow: hidden;
}

.quick-view-overlay {
    background: rgba(0,0,0,0.7);
    border-radius: 50px;
    padding: 10px;
    transition: opacity 0.3s ease;
}

.product-badges .badge {
    display: block;
    margin-bottom: 5px;
    width: fit-content;
}
</style>